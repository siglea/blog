---
layout: post
title:  "用户画像之标签存储"
date:   2020-07-07 17:18:00 +0900
comments: true
tags:
- 用户
categories:
- 技术

---
#### 数据仓库
“数据􏱓库􏲄父”W.H.Inmon􏱖《Building the Data Warehouse》在一书􏰇􏰷定义数据􏱓仓库是“一个􏱥面􏰤向主题的、集成的、非易失的、随时􏰣变化的、用来支持􏲆管理人员决策的数据集合􏰬”。
- 面􏰤向主题:业􏰊务数据库中􏰷的数据主要􏲊对事务处􏲋理，各个业􏱇􏱥􏰊务系统之间􏰦􏰮􏲄􏰣是相互分离的，而􏱽数据􏱓仓库中􏰷的数据是􏲌按照一定主题进行组织的。
- 集成:数据仓􏱓库中􏰷存储的数据是从业􏰊务数据库中􏰷提取出来的，但􏱟并不是对原有数据的􏱂简单复􏲍制，而􏱽是经过了抽􏲎􏱗􏱞􏲏取、清􏲐理、转􏲑换 (ETL)等􏱣工作􏰔。业􏰊务数据库记􏱀录的是每􏱤一项􏰊业务处􏲋理的流水􏰸􏲒账。这􏲓些数据不适􏰬进行分析处理，进入数据􏱓库􏲄前需要􏲎􏱗一系列计算􏰢， 同时􏲔􏲕抛弃一些无关分析处理的数据。
- 非易􏲅失:􏰊业务数据库中􏰷一般􏲃􏲖存储短期数据，􏲗因此其数据是不稳定的，记􏱀的是􏰦􏰮􏰷数据变化的瞬态􏱪。数据􏱓仓库中􏰷的数据􏱝􏱿大多表示过􏱗去某􏱋一时刻的数据，主要用于查询、分析􏱼，不像􏰊业务系统中􏰦􏰮􏰷的数据库一样􏲎经常修改，一般􏲃数据􏱓仓库构􏰼建完成后主要用于􏰋访问􏱭，不进行修􏲘改􏱰删除。
- 随时􏰣变化:数据仓􏱓库关注􏱩的是历史􏲙数据，按􏲌时间􏰣顺序定期从􏰊业务库和􏱰日志􏱺库里面载􏲚入新的数据进行追􏲛加，带有时间属性􏰲。

#### 标签分区存储
<img src="/img/up1.jpeg" width="600px">
- 数字表示
    - 0：用户没被打上该标签
    - 1：用户被打上该标签，但是没有具体数值
    - 具体数字：用户被打上该标签，有具体数值
<img src="/img/up2.jpg" width="600px">

#### 标签以UserID进行冗余存储
<img src="/img/up3.jpg" width="600px">

#### ID-MAP
- 用户使用不同设备登录系统，或者同一设备登录多个用户
- 可以通过event_log、page_view_log等来获取登录时长、登录天数
- userid与cookieId通常是多对多
<img src="/img/up4.jpg" width="600px">

#### Mysql存储元数据管理
<img src="/img/up5.jpg" width="600px">

#### Mysql存储结果集
比如用脚本通过Sqoop把Hive结果导入的mysql中，主要是离线，在线的建议用HBase

#### HBase存储
使用Spark，把用户标签同步到HBase以供线上实时访问
<img src="/img/up6.jpg" width="600px" />

#### Es做为HBase的二级索引方便快速检索
<img src="/img/up7.jpg" width="600px" />

#### 从ETL/Hiv/HBase/Es整个链路的数据监控，旧数据可怕
<img src="/img/up8.jpg" width="600px" />